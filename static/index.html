<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>å·¥å» è£½ç¨‹ç‰©æµè¿½æº¯ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ========== Apple Human Interface Guidelines è¦ç¯„æ¨£å¼ ========== */
        
        /* åŸºç¤è¨­å®š */
        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }
        
        /* iOS æ¨™æº–é¡è‰²ç³»çµ± */
        :root {
            /* ç³»çµ±é¡è‰² */
            --ios-blue: #007AFF;
            --ios-green: #34C759;
            --ios-red: #FF3B30;
            --ios-orange: #FF9500;
            --ios-purple: #AF52DE;
            --ios-pink: #FF2D55;
            --ios-yellow: #FFCC00;
            
            /* èƒŒæ™¯é¡è‰² */
            --ios-bg-primary: #FFFFFF;
            --ios-bg-secondary: #F2F2F7;
            --ios-bg-tertiary: #FFFFFF;
            
            /* æ–‡å­—é¡è‰² */
            --ios-text-primary: #000000;
            --ios-text-secondary: rgba(60, 60, 67, 0.6);
            --ios-text-tertiary: rgba(60, 60, 67, 0.3);
            
            /* åˆ†éš”ç·šé¡è‰² */
            --ios-separator: rgba(60, 60, 67, 0.29);
            --ios-separator-opaque: #C6C6C8;
            
            /* é™°å½± */
            --ios-shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --ios-shadow-md: 0 2px 8px rgba(0, 0, 0, 0.1);
            --ios-shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif;
            background: var(--ios-bg-secondary);
            min-height: 100vh;
            padding-bottom: env(safe-area-inset-bottom);
            color: var(--ios-text-primary);
            font-size: 17px;
            line-height: 1.47059;
            letter-spacing: -0.022em;
        }
        
        /* ========== å­—é«”ç³»çµ±ï¼ˆç¬¦åˆ iOS æ¨™æº–ï¼‰ ========== */
        h1 {
            font-size: 28px;
            font-weight: 600;
            letter-spacing: -0.028em;
            line-height: 1.10762;
        }
        
        h2 {
            font-size: 22px;
            font-weight: 600;
            letter-spacing: -0.022em;
            line-height: 1.18182;
        }
        
        h3 {
            font-size: 20px;
            font-weight: 600;
            letter-spacing: -0.02em;
            line-height: 1.2;
        }
        
        /* æ­£æ–‡ï¼š17px */
        p, .text-body {
            font-size: 17px;
            font-weight: 400;
            letter-spacing: -0.022em;
            line-height: 1.47059;
        }
        
        /* å°å­—ï¼š15px */
        .text-small {
            font-size: 15px;
            font-weight: 400;
            letter-spacing: -0.016em;
            line-height: 1.33337;
        }
        
        /* æ¨™ç±¤ï¼š13px */
        .text-label {
            font-size: 13px;
            font-weight: 400;
            letter-spacing: -0.008em;
            line-height: 1.38462;
        }
        
        /* ========== é–“è·ç³»çµ±ï¼ˆ8px åŸºç¤å–®ä½ï¼‰ ========== */
        .spacing-xs { margin: 4px; padding: 4px; }
        .spacing-sm { margin: 8px; padding: 8px; }
        .spacing-md { margin: 16px; padding: 16px; }
        .spacing-lg { margin: 24px; padding: 24px; }
        .spacing-xl { margin: 32px; padding: 32px; }
        
        /* ========== å¡ç‰‡æ¨£å¼ï¼ˆ16px åœ“è§’ï¼‰ ========== */
        .glass {
            background: var(--ios-bg-primary);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 0.5px solid var(--ios-separator);
        }
        
        .card {
            background: var(--ios-bg-primary);
            border-radius: 16px;
            box-shadow: var(--ios-shadow-md);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card:hover {
            box-shadow: var(--ios-shadow-lg);
        }
        
        /* ========== æŒ‰éˆ•æ¨£å¼ï¼ˆ44px è§¸æ§ç›®æ¨™ï¼Œ10px åœ“è§’ï¼‰ ========== */
        .btn-primary {
            background: var(--ios-blue);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-size: 17px;
            font-weight: 400;
            letter-spacing: -0.022em;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        
        .btn-primary:hover {
            background: #0051D5;
        }
        
        .btn-primary:active {
            background: #0040B3;
            transform: scale(0.98);
        }
        
        .btn-secondary {
            background: var(--ios-bg-secondary);
            color: var(--ios-text-primary);
            border: 0.5px solid var(--ios-separator);
            border-radius: 10px;
            padding: 12px 24px;
            font-size: 17px;
            font-weight: 400;
            letter-spacing: -0.022em;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        
        .btn-secondary:hover {
            background: #E5E5EA;
        }
        
        .btn-secondary:active {
            background: #D1D1D6;
            transform: scale(0.98);
        }
        
        .btn-text {
            background: transparent;
            color: var(--ios-blue);
            border: none;
            padding: 8px 16px;
            font-size: 17px;
            font-weight: 400;
            letter-spacing: -0.022em;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.2s;
            cursor: pointer;
        }
        
        .btn-text:hover {
            opacity: 0.7;
        }
        
        .btn-text:active {
            opacity: 0.5;
        }
        
        /* èˆŠç‰ˆæŒ‰éˆ•å…¼å®¹ */
        .btn-capsule {
            border-radius: 10px;
            padding: 12px 24px;
            font-size: 17px;
            font-weight: 400;
            letter-spacing: -0.022em;
            min-height: 44px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-capsule:active {
            transform: scale(0.98);
        }
        
        /* ========== è¼¸å…¥æ¡†æ¨£å¼ï¼ˆ12px åœ“è§’ï¼‰ ========== */
        .input-ios {
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 17px;
            font-weight: 400;
            letter-spacing: -0.022em;
            background: var(--ios-bg-primary);
            border: 0.5px solid var(--ios-separator);
            transition: all 0.2s;
            min-height: 44px;
        }
        
        .input-ios:focus {
            outline: none;
            border-color: var(--ios-blue);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
        }
        
        .input-ios::placeholder {
            color: var(--ios-text-tertiary);
        }
        
        /* ========== åŠŸèƒ½å¡ç‰‡ï¼ˆç¬¦åˆ iOS Widget é¢¨æ ¼ï¼‰ ========== */
        .feature-card {
            background: var(--ios-bg-primary);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 0.5px solid var(--ios-separator);
            box-shadow: var(--ios-shadow-sm);
            position: relative;
            overflow: hidden;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
            pointer-events: auto;
        }
        
        .feature-card:active {
            transform: scale(0.98);
            box-shadow: var(--ios-shadow-md);
        }
        
        .feature-card:hover {
            box-shadow: var(--ios-shadow-md);
        }
        
        .feature-icon-wrapper {
            margin-bottom: 12px;
            min-height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .feature-icon-img {
            width: 56px;
            height: 56px;
            display: block;
            object-fit: contain;
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .feature-icon-emoji {
            font-size: 40px;
            display: block;
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .feature-card:active .feature-icon-img,
        .feature-card:active .feature-icon-emoji {
            transform: scale(0.95);
        }
        
        .feature-title {
            font-size: 17px;
            font-weight: 600;
            letter-spacing: -0.022em;
            margin-bottom: 4px;
        }
        
        .feature-subtitle {
            font-size: 13px;
            font-weight: 400;
            letter-spacing: -0.008em;
            opacity: 0.6;
        }
        
        /* ========== è­¦ç¤ºè¦–çª—ï¼ˆiOS é¢¨æ ¼ï¼‰ ========== */
        .alert-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        #processingOverlay {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        
        .alert-dialog {
            background: var(--ios-bg-primary);
            border-radius: 16px;
            padding: 24px;
            max-width: 320px;
            width: 90%;
            box-shadow: var(--ios-shadow-lg);
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ========== æˆåŠŸå¡ç‰‡ ========== */
        .success-card {
            animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-10px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* ========== åº•éƒ¨å·¥ä½œè¡¨ï¼ˆiOS é¢¨æ ¼ï¼‰ ========== */
        .bottom-sheet-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 99;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .bottom-sheet-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        
        .bottom-sheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--ios-bg-primary);
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
            z-index: 100;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        .bottom-sheet.open {
            transform: translateY(0);
        }
        
        .bottom-sheet > div {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            flex: 1;
            padding-bottom: env(safe-area-inset-bottom, 0);
        }
        
        .bottom-sheet-header {
            flex-shrink: 0;
            padding: 16px 20px 0 20px;
            border-bottom: 0.5px solid var(--ios-separator);
        }
        
        .bottom-sheet-content {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 16px 20px 20px 20px;
        }
        
        /* ========== è¿½æº¯çµæœé é¢ ========== */
        .trace-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--ios-bg-secondary);
            z-index: 200;
            display: none;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .trace-page.open {
            display: flex;
        }
        
        .trace-header {
            background: var(--ios-bg-primary);
            color: var(--ios-text-primary);
            padding: 16px 20px;
            box-shadow: var(--ios-shadow-sm);
            border-bottom: 0.5px solid var(--ios-separator);
        }
        
        .trace-station-card {
            background: var(--ios-bg-primary);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: var(--ios-shadow-sm);
            border: 0.5px solid var(--ios-separator);
        }
        
        .trace-station-header {
            font-size: 17px;
            font-weight: 600;
            letter-spacing: -0.022em;
            color: var(--ios-text-primary);
            margin-bottom: 12px;
        }
        
        .trace-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 0.5px solid var(--ios-separator);
        }
        
        .trace-info-row:last-child {
            border-bottom: none;
        }
        
        .trace-info-label {
            color: var(--ios-text-secondary);
            font-size: 15px;
            font-weight: 400;
            letter-spacing: -0.016em;
        }
        
        .trace-info-value {
            color: var(--ios-text-primary);
            font-size: 15px;
            font-weight: 500;
            letter-spacing: -0.016em;
        }
        
        /* ========== å·¥å…·é¡ ========== */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* ========== éŸ¿æ‡‰å¼è¨­è¨ˆ ========== */
        @media (max-width: 768px) {
            .feature-card {
                padding: 20px;
                min-height: 100px;
            }
            
            .feature-icon-wrapper {
                min-height: 48px;
            }
            
            .feature-icon-img {
                width: 48px;
                height: 48px;
            }
            
            .feature-icon-emoji {
                font-size: 36px;
            }
            
            .feature-title {
                font-size: 17px;
            }
            
            .feature-subtitle {
                font-size: 13px;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- è¨­å®šé é¢ï¼ˆå¼·åˆ¶ç™»å…¥ï¼‰ -->
    <div id="setupPage" class="min-h-screen flex items-center justify-center p-6 hidden" style="background: var(--ios-bg-secondary);">
        <div class="w-full max-w-md">
            <div class="text-center mb-8">
                <h1 style="color: var(--ios-text-primary); margin-bottom: 8px;">å·¥å» è£½ç¨‹ç‰©æµè¿½æº¯ç³»çµ±</h1>
                <p class="text-small" style="color: var(--ios-text-secondary);">è«‹å…ˆè¨­å®šæ‚¨çš„å·¥è™Ÿèˆ‡ç«™é»</p>
            </div>
            
            <div class="card glass" style="padding: 24px;">
                <div style="margin-bottom: 20px;">
                    <label class="text-label" style="display: block; color: var(--ios-text-secondary); margin-bottom: 8px;">å·¥è™Ÿ</label>
                    <input 
                        type="text" 
                        id="operatorInput" 
                        class="input-ios w-full" 
                        placeholder="ä¾‹å¦‚ï¼šOP01"
                        autocomplete="off"
                    >
                </div>
                
                <div style="margin-bottom: 24px;">
                    <label class="text-label" style="display: block; color: var(--ios-text-secondary); margin-bottom: 8px;">ç•¶å‰ç«™é»</label>
                    <select id="stationSelect" class="input-ios w-full">
                        <option value="">è«‹é¸æ“‡ç«™é»</option>
                    </select>
                </div>
                
                <button 
                    id="saveSetupBtn" 
                    class="btn-primary w-full"
                >
                    å„²å­˜è¨­å®š
                </button>
            </div>
        </div>
    </div>
    
    <!-- ä¸»åŠŸèƒ½é é¢ -->
    <div id="mainPage" class="min-h-screen pb-24 hidden" style="background: var(--ios-bg-secondary);">
        <!-- é ‚éƒ¨å€åŸŸ -->
        <div style="background: var(--ios-bg-primary); border-bottom: 0.5px solid var(--ios-separator);">
            <div class="max-w-6xl mx-auto" style="padding: 20px 20px 16px 20px;">
                <!-- æ¨™é¡Œå€åŸŸï¼ˆå«è®Šæ›´è¨­å®šæŒ‰éˆ•ï¼‰ -->
                <div class="flex items-start justify-between" style="margin-bottom: 16px;">
                    <div class="flex-1">
                        <h1 style="color: var(--ios-text-primary); margin-bottom: 4px;">å·¥å» è£½ç¨‹ç‰©æµè¿½æº¯</h1>
                        <p class="text-small" style="color: var(--ios-text-secondary);">è¿½è¹¤æ¯ä¸€é“å·¥åºï¼Œç¢ºä¿å“è³ªå¯è¿½æº¯</p>
                    </div>
                    <button 
                        id="changeSetupBtn" 
                        class="btn-text"
                        style="margin-left: 16px; flex-shrink: 0;"
                    >
                        è¨­å®š
                    </button>
                </div>
                
                <!-- åˆ†éš”ç·š -->
                <div style="border-top: 0.5px solid var(--ios-separator); margin-bottom: 16px;"></div>
                
                <!-- ç”¨æˆ¶è³‡è¨Šå¡ç‰‡ -->
                <div class="flex gap-3">
                    <div class="flex-1 card glass" style="padding: 16px; border-radius: 16px;">
                        <p class="text-label" style="color: var(--ios-text-secondary); margin-bottom: 4px;">æ“ä½œå“¡</p>
                        <p class="text-body" style="font-weight: 600; color: var(--ios-text-primary);" id="operatorDisplay">-</p>
                    </div>
                    <div class="flex-1 card glass" style="padding: 16px; border-radius: 16px;">
                        <p class="text-label" style="color: var(--ios-text-secondary); margin-bottom: 4px;">ç•¶å‰ç«™é»</p>
                        <p class="text-body" style="font-weight: 600; color: var(--ios-text-primary);" id="stationDisplay">-</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- è¨Šæ¯é¡¯ç¤ºå€åŸŸï¼ˆå›ºå®šç©ºé–“ï¼‰ -->
        <div class="max-w-6xl mx-auto" style="padding: 16px 20px; min-height: 80px;">
            <div id="successCard" class="card glass hidden success-card" style="padding: 16px; background: rgba(52, 199, 89, 0.1); border: 0.5px solid rgba(52, 199, 89, 0.3);">
                <div class="flex items-center">
                    <div style="font-size: 24px; margin-right: 12px;">âœ…</div>
                    <div class="flex-1">
                        <p class="text-body" style="font-weight: 600; color: #1D7A3C;" id="successMessage">æ“ä½œæˆåŠŸ</p>
                        <p class="text-small whitespace-pre-line" style="color: #2D9554; margin-top: 4px;" id="successDetail"></p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åŠŸèƒ½å€åŸŸ -->
        <div class="max-w-6xl mx-auto" style="padding: 0 20px 32px 20px;">
            <h2 class="text-center" style="color: var(--ios-text-primary); margin-bottom: 20px;">åŠŸèƒ½é¸å–®</h2>
            
            <!-- åŠŸèƒ½å¡ç‰‡ç¶²æ ¼ -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3" style="gap: 12px;">
                <button 
                    id="inboundBtn" 
                    class="feature-card"
                    style="background: var(--ios-green) !important; color: white; border: none;"
                >
                    <div class="feature-icon-wrapper">
                        <img src="/static/images/icons/inbound.png" alt="è²¨ç‰©é·å…¥" class="feature-icon-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <span class="feature-icon-emoji" style="display: none;">ğŸ“¦</span>
                    </div>
                    <div class="feature-title" style="color: white;">è²¨ç‰©é·å…¥</div>
                    <div class="feature-subtitle" style="color: rgba(255, 255, 255, 0.8);">æ¥æ”¶ä¸Šæ¸¸ç«™é»è²¨ç‰©</div>
                </button>
                
                <button 
                    id="outboundBtn" 
                    class="feature-card"
                    style="background: var(--ios-blue) !important; color: white; border: none;"
                >
                    <div class="feature-icon-wrapper">
                        <img src="/static/images/icons/outbound.png" alt="è²¨ç‰©é·å‡º" class="feature-icon-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <span class="feature-icon-emoji" style="display: none;">ğŸš€</span>
                    </div>
                    <div class="feature-title" style="color: white;">è²¨ç‰©é·å‡º</div>
                    <div class="feature-subtitle" style="color: rgba(255, 255, 255, 0.8);">å®ŒæˆåŠ å·¥å¾Œé·å‡º</div>
                </button>
                
                <button 
                    id="traceBtn" 
                    class="feature-card"
                    style="background: var(--ios-purple) !important; color: white; border: none;"
                >
                    <div class="feature-icon-wrapper">
                        <img src="/static/images/icons/trace.png" alt="è¿½æº¯æŸ¥è©¢" class="feature-icon-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <span class="feature-icon-emoji" style="display: none;">ğŸ”</span>
                    </div>
                    <div class="feature-title" style="color: white;">è¿½æº¯æŸ¥è©¢</div>
                    <div class="feature-subtitle" style="color: rgba(255, 255, 255, 0.8);">æŸ¥è©¢å®Œæ•´è£½ç¨‹è¨˜éŒ„</div>
                </button>
                
                <button 
                    id="firstBtn" 
                    class="feature-card hidden"
                    style="background: var(--ios-orange) !important; color: white; border: none;"
                >
                    <div class="feature-icon-wrapper">
                        <img src="/static/images/icons/first.png" alt="é¦–ç«™é·å‡º" class="feature-icon-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <span class="feature-icon-emoji" style="display: none;">âœ¨</span>
                    </div>
                    <div class="feature-title" style="color: white;">é¦–ç«™é·å‡º</div>
                    <div class="feature-subtitle" style="color: rgba(255, 255, 255, 0.8);">æ–°å·¥å–®é¦–ç«™ä½œæ¥­</div>
                </button>
            </div>
        </div>
    </div>
    
    <!-- åº•éƒ¨å·¥ä½œè¡¨ï¼ˆæƒæè¼¸å…¥ï¼‰ -->
    <!-- è¿½æº¯çµæœé é¢ -->
    <div id="tracePage" class="trace-page">
        <div class="trace-header">
            <div class="flex items-center justify-between" style="margin-bottom: 12px;">
                <h2 style="color: var(--ios-text-primary);" id="traceOrderTitle">è¿½æº¯æŸ¥è©¢</h2>
                <button id="closeTracePageBtn" class="btn-text" style="padding: 8px; min-height: auto; font-size: 24px; line-height: 1; color: var(--ios-text-primary);">Ã—</button>
            </div>
            <div class="text-small" style="color: var(--ios-text-secondary);" id="traceSkuInfo"></div>
        </div>
        <div class="flex-1 p-4" id="traceContent">
            <!-- è¿½æº¯å…§å®¹å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
        </div>
    </div>
    
    <!-- åº•éƒ¨å·¥ä½œè¡¨èƒŒæ™¯é®ç½© -->
    <div id="bottomSheetOverlay" class="bottom-sheet-overlay"></div>
    
    <!-- åº•éƒ¨å·¥ä½œè¡¨ -->
    <div id="bottomSheet" class="bottom-sheet">
        <div class="bottom-sheet-header">
            <div class="flex items-center justify-between" style="padding-bottom: 16px;">
                <h3 style="color: var(--ios-text-primary);" id="sheetTitle">æƒææ¢ç¢¼</h3>
                <button id="closeSheetBtn" class="btn-text" style="padding: 8px; min-height: auto; font-size: 24px; line-height: 1;">Ã—</button>
            </div>
        </div>
        
        <div class="bottom-sheet-content">
            <div style="margin-bottom: 20px;">
                <label class="text-label" style="display: block; color: var(--ios-text-secondary); margin-bottom: 8px;">æ¢ç¢¼</label>
                <input 
                    type="text" 
                    id="barcodeInput" 
                    class="input-ios w-full" 
                    placeholder="æƒææˆ–è¼¸å…¥æ¢ç¢¼"
                    autocomplete="off"
                    autofocus
                >
            </div>
            
            <!-- é·å…¥å°ˆç”¨æ¬„ä½ï¼šæ¢ç¢¼é¸æ“‡åˆ—è¡¨ -->
            <div id="inboundBarcodeSelection" class="hidden" style="margin-bottom: 20px;">
                <label class="text-label" style="display: block; color: var(--ios-text-secondary); margin-bottom: 8px;">é¸æ“‡è¦ä¸€èµ·é·å…¥çš„æ¢ç¢¼ï¼ˆç›¸åŒå·¥å–®ï¼‰</label>
                <!-- å…¨é¸/å…¨éƒ¨å–æ¶ˆæŒ‰éˆ• -->
                <div class="flex gap-2" style="margin-bottom: 12px;">
                    <button id="selectAllBarcodesBtn" class="btn-primary flex-1" style="font-size: 15px; padding: 10px 16px;">
                        âœ“ å…¨é¸
                    </button>
                    <button id="deselectAllBarcodesBtn" class="btn-secondary flex-1" style="font-size: 15px; padding: 10px 16px;">
                        âœ— å…¨éƒ¨å–æ¶ˆ
                    </button>
                </div>
                <div id="barcodeSelectionList" class="space-y-2 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50">
                    <!-- æ¢ç¢¼é¸æ“‡é …ç›®å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- é·å‡ºå°ˆç”¨æ¬„ä½ -->
            <div id="outboundFields" class="hidden space-y-4">
                <!-- æŠ•å…¥é‡é¡¯ç¤ºå€å¡Š -->
                <div id="outboundInboundInfo" class="card glass hidden" style="padding: 16px; background: rgba(0, 122, 255, 0.1); border: 0.5px solid rgba(0, 122, 255, 0.3); margin-bottom: 16px;">
                    <div class="flex items-center" style="margin-bottom: 8px;">
                        <span class="text-body" style="font-weight: 600; color: #003D99;">ğŸ“Š ç•¶å‰ç«™é»æŠ•å…¥é‡</span>
                    </div>
                    <div class="text-small" style="color: #0051D5;">
                        <p id="outboundInboundQty" class="text-body" style="font-weight: 600;">è¨ˆç®—ä¸­...</p>
                    </div>
                </div>
                
                <!-- è‰¯å“å€å¡Š -->
                <div class="card glass" style="padding: 16px; background: rgba(52, 199, 89, 0.1); border: 0.5px solid rgba(52, 199, 89, 0.3); margin-bottom: 16px;">
                    <div class="flex items-center" style="margin-bottom: 12px;">
                        <div style="width: 8px; height: 8px; border-radius: 50%; background: var(--ios-green); margin-right: 8px;"></div>
                        <h3 class="text-body" style="font-weight: 600; color: var(--ios-text-primary);">è‰¯å“</h3>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div>
                            <label class="text-label" style="display: block; color: var(--ios-text-secondary); margin-bottom: 8px;">æ•¸é‡</label>
                            <input 
                                type="text" 
                                id="goodQtyInput" 
                                class="input-ios w-full" 
                                placeholder="ä¾‹å¦‚ï¼š0100"
                                autocomplete="off"
                            >
                        </div>
                        
                        <div>
                            <label class="text-label" style="display: block; color: var(--ios-text-secondary); margin-bottom: 8px;">å®¹å™¨</label>
                            <select id="goodContainerSelect" class="input-ios w-full">
                                <option value="">è«‹é¸æ“‡å®¹å™¨</option>
                            </select>
                        </div>
                        
                        <!-- è‡ªå‹•è¨ˆç®—çš„ç®±æ•¸é è¦½ -->
                        <div id="goodBoxPreview" class="text-small hidden" style="color: var(--ios-text-secondary);">
                            <div class="flex items-center">
                                <span style="font-weight: 500;">é ä¼°ç®±æ•¸ï¼š</span>
                                <span id="goodBoxCount" style="margin-left: 8px; font-weight: 600; color: var(--ios-green);">-</span>
                                <span style="margin-left: 4px;">ç®±</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ä¸è‰¯å“å€å¡Š -->
                <div class="card glass" style="padding: 16px; background: rgba(255, 59, 48, 0.1); border: 0.5px solid rgba(255, 59, 48, 0.3); margin-bottom: 16px;">
                    <div class="flex items-center" style="margin-bottom: 12px;">
                        <div style="width: 8px; height: 8px; border-radius: 50%; background: var(--ios-red); margin-right: 8px;"></div>
                        <h3 class="text-body" style="font-weight: 600; color: var(--ios-text-primary);">ä¸è‰¯å“</h3>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div>
                            <label class="text-label" style="display: block; color: var(--ios-text-secondary); margin-bottom: 8px;">æ•¸é‡</label>
                            <input 
                                type="text" 
                                id="badQtyInput" 
                                class="input-ios w-full" 
                                placeholder="ä¾‹å¦‚ï¼š0005"
                                autocomplete="off"
                            >
                        </div>
                        
                        <div>
                            <label class="text-label" style="display: block; color: var(--ios-text-secondary); margin-bottom: 8px;">å®¹å™¨</label>
                            <select id="badContainerSelect" class="input-ios w-full">
                                <option value="">è«‹é¸æ“‡å®¹å™¨</option>
                            </select>
                        </div>
                        
                        <!-- è‡ªå‹•è¨ˆç®—çš„ç®±æ•¸é è¦½ -->
                        <div id="badBoxPreview" class="text-small hidden" style="color: var(--ios-text-secondary);">
                            <div class="flex items-center">
                                <span style="font-weight: 500;">é ä¼°ç®±æ•¸ï¼š</span>
                                <span id="badBoxCount" style="margin-left: 8px; font-weight: 600; color: var(--ios-red);">-</span>
                                <span style="margin-left: 4px;">ç®±</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æç¤ºè¨Šæ¯ -->
                <div class="text-label text-center" style="color: var(--ios-text-tertiary); margin-top: 16px;">
                    <p>ğŸ’¡ è‡³å°‘éœ€è¦å¡«å¯«ä¸€çµ„ï¼ˆè‰¯å“æˆ–ä¸è‰¯å“ï¼‰</p>
                    <p>ç³»çµ±æœƒè‡ªå‹•è¨ˆç®—æ‰€éœ€ç®±æ•¸ä¸¦ç”Ÿæˆæ¢ç¢¼</p>
                </div>
            </div>
            
            <!-- é¦–ç«™é·å‡ºå°ˆç”¨æ¬„ä½ -->
            <div id="firstFields" class="hidden" style="display: flex; flex-direction: column; gap: 16px;">
                <div>
                    <label class="text-label" style="display: block; color: var(--ios-text-secondary); margin-bottom: 8px;">å·¥å–®è™Ÿ</label>
                    <input 
                        type="text" 
                        id="orderInput" 
                        class="input-ios w-full" 
                        placeholder="ä¾‹å¦‚ï¼š251119AA"
                        autocomplete="off"
                        style="text-transform: uppercase;"
                    >
                </div>
                
                <div>
                    <label class="text-label" style="display: block; color: var(--ios-text-secondary); margin-bottom: 8px;">ç”¢å“ç·š</label>
                    <select id="seriesSelect" class="input-ios w-full">
                        <option value="">è«‹é¸æ“‡ç”¢å“ç·š</option>
                    </select>
                </div>
                
                <div>
                    <label class="text-label" style="display: block; color: var(--ios-text-secondary); margin-bottom: 8px;">æ©Ÿç¨®</label>
                    <select id="modelSelect" class="input-ios w-full">
                        <option value="">è«‹é¸æ“‡æ©Ÿç¨®</option>
                    </select>
                </div>
                
                <div>
                    <label class="text-label" style="display: block; color: var(--ios-text-secondary); margin-bottom: 8px;">å®¹å™¨</label>
                    <select id="firstContainerSelect" class="input-ios w-full">
                        <option value="">è«‹é¸æ“‡å®¹å™¨</option>
                    </select>
                </div>
                
                <!-- ç®±è™Ÿå·²éš±è—ï¼Œç”±ç³»çµ±è‡ªå‹•è¨ˆç®— -->
                
                <div>
                    <label class="text-label" style="display: block; color: var(--ios-text-secondary); margin-bottom: 8px;">è²¨æ…‹</label>
                    <select id="firstStatusSelect" class="input-ios w-full">
                        <option value="G">G - è‰¯å“</option>
                        <option value="N">N - ä¸è‰¯</option>
                        <option value="S">S - ç‰¹æ¡</option>
                        <option value="R">R - è¿”å·¥</option>
                        <option value="E">E - éºå¤±</option>
                    </select>
                </div>
                
                <div>
                    <label class="text-label" style="display: block; color: var(--ios-text-secondary); margin-bottom: 8px;">æ•¸é‡</label>
                    <input 
                        type="text" 
                        id="firstQtyInput" 
                        class="input-ios w-full" 
                        placeholder="ä¾‹å¦‚ï¼š0100"
                        autocomplete="off"
                    >
                </div>
            </div>
            
            <button 
                id="submitBtn" 
                class="btn-primary w-full"
                style="margin-top: 24px; margin-bottom: 16px;"
            >
                æäº¤
            </button>
        </div>
        </div>
    </div>
    
    <!-- QR Code å½ˆå‡ºè¦–çª— -->
    <!-- æ¢ç¢¼é¸æ“‡å…¨ç•«é¢å½ˆå‡ºè¦–çª— -->
    <div id="barcodeSelectionOverlay" class="alert-overlay hidden">
        <div class="alert-dialog" style="max-width: 95%; max-height: 95vh; width: 95%; overflow-y: auto; padding: 0;">
            <div class="relative bg-white rounded-20" style="min-height: 100%;">
                <!-- æ¨™é¡Œåˆ— -->
                <div class="sticky top-0 z-10" style="background: var(--ios-bg-primary); border-bottom: 0.5px solid var(--ios-separator); padding: 16px; border-radius: 16px 16px 0 0;">
                    <div class="flex items-center justify-between" style="margin-bottom: 12px;">
                        <h3 style="color: var(--ios-text-primary);">é¸æ“‡è¦ä¸€èµ·é·å…¥çš„æ¢ç¢¼ï¼ˆç›¸åŒå·¥å–®ï¼‰</h3>
                        <button 
                            id="closeBarcodeSelectionBtn" 
                            class="btn-text"
                            style="padding: 8px; min-height: auto; font-size: 24px; line-height: 1;"
                        >
                            Ã—
                        </button>
                    </div>
                    <!-- å…¨é¸/å…¨éƒ¨å–æ¶ˆæŒ‰éˆ• -->
                    <div class="flex gap-2 justify-center">
                        <button id="selectAllBarcodesBtn" class="btn-primary" style="font-size: 15px; padding: 10px 24px;">
                            âœ“ å…¨é¸
                        </button>
                        <button id="deselectAllBarcodesBtn" class="btn-secondary" style="font-size: 15px; padding: 10px 24px;">
                            âœ— å…¨éƒ¨å–æ¶ˆ
                        </button>
                    </div>
                </div>
                <!-- æ¢ç¢¼åˆ—è¡¨ -->
                <div id="barcodeSelectionList" class="p-4 space-y-2" style="max-height: calc(95vh - 120px); overflow-y: auto;">
                    <!-- æ¢ç¢¼é¸æ“‡é …ç›®å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                </div>
                <!-- ç¢ºèªæŒ‰éˆ• -->
                <div class="sticky bottom-0" style="background: var(--ios-bg-primary); border-top: 0.5px solid var(--ios-separator); padding: 16px; border-radius: 0 0 20px 20px;">
                    <button id="confirmInboundBtn" class="btn-primary w-full">
                        ç¢ºèªé·å…¥
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="qrcodeOverlay" class="alert-overlay hidden">
        <div class="alert-dialog" style="max-width: 90%; max-height: 90vh; overflow-y: auto;">
            <div class="relative">
                <!-- é—œé–‰æŒ‰éˆ•ï¼ˆå³ä¸Šè§’ï¼‰ -->
                <button 
                    id="closeQrcodeBtn" 
                    class="absolute top-0 right-0 text-gray-500 text-3xl font-light hover:text-gray-700"
                    style="line-height: 1; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; z-index: 10;"
                >
                    Ã—
                </button>
                
                <div class="text-center" style="margin-bottom: 16px;">
                    <h3 style="color: var(--ios-text-primary); margin-bottom: 16px;">æ¢ç¢¼ QR Code</h3>
                </div>
                
                <div id="qrcodeContainer">
                    <!-- QR Code å…§å®¹å°‡åœ¨é€™è£¡é¡¯ç¤º -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- è™•ç†ä¸­è¦–çª— -->
    <div id="processingOverlay" class="alert-overlay hidden">
        <div class="alert-dialog">
            <div class="text-center">
                <div class="mb-4" id="processingSpinner">
                    <div class="spinner" style="width: 48px; height: 48px; border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
                </div>
                <h3 class="text-xl font-semibold mb-2" id="processingTitle">è™•ç†ä¸­...</h3>
                <p class="text-gray-600" id="processingMessage">æ­£åœ¨å¯«å…¥ Google Sheets</p>
            </div>
        </div>
    </div>
    
    <!-- è­¦ç¤ºè¦–çª— -->
    <div id="alertOverlay" class="alert-overlay hidden">
        <div class="alert-dialog">
            <div class="text-center">
                <div style="font-size: 48px; margin-bottom: 16px;" id="alertIcon">âš ï¸</div>
                <h3 style="color: var(--ios-text-primary); margin-bottom: 8px;" id="alertTitle">éŒ¯èª¤</h3>
                <p class="text-small" style="color: var(--ios-text-secondary); margin-bottom: 24px;" id="alertMessage"></p>
                <button 
                    id="alertOkBtn" 
                    class="btn-primary w-full"
                    style="background: var(--ios-red);"
                >
                    ç¢ºå®š
                </button>
            </div>
        </div>
    </div>
    
    <script src="/static/app.js"></script>
</body>
</html>

