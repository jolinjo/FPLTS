# ç”¢å“éœ€æ±‚æ–‡ä»¶ (PRD)
## å°ˆæ¡ˆï¼šå·¥å» è£½ç¨‹ç‰©æµè¿½æº¯èˆ‡åˆ†æç³»çµ± (FPLTS) - V6 Final
### Project: Factory Process Logistics & Traceability System

---

## 1. å°ˆæ¡ˆæ¦‚è§€ (Overview)

æœ¬ç³»çµ±ç‚ºå·¥å» ç”Ÿç”¢è¿½æº¯åŸå‹ã€‚é€éæ‰‹æ©ŸæƒæäºŒç¶­æ¢ç¢¼ï¼Œç®¡ç†è²¨ç‰©åœ¨å„è£½ç¨‹ç«™é»æµè½‰ã€‚

**æ ¸å¿ƒåƒ¹å€¼**ï¼š
1. **å…¨æµç¨‹è¿½æº¯**ï¼šç´€éŒ„é·å…¥/é·å‡ºæ™‚é–“ã€å·¥æ™‚èˆ‡è‰¯ç‡ã€‚
2. **æµç¨‹é˜²å‘† (New)**ï¼šé€é INI å®šç¾©è£½ç¨‹æµï¼Œé˜²æ­¢æ¼ç«™æˆ–è·³ç«™ã€‚
3. **æ¬Šé™ç®¡æ§**ï¼šå¼·åˆ¶å·¥è™Ÿç™»å…¥ã€‚
4. **iOS é¢¨æ ¼ä»‹é¢**ï¼šæ¥µè‡´çš„è¡Œå‹•ç«¯æ“ä½œé«”é©—ã€‚

---

## 2. æŠ€è¡“æ¶æ§‹ (Tech Stack)

- **Backend**: Python (FastAPI) + Background Tasks
- **Database**: Google Sheets (via `gspread`)
- **Frontend**: Mobile Web (HTML5 + Tailwind CSS)
- **Config**: INI Files (Process, Product, Flow)

---

## 3. è¨­å®šæª”é©…å‹•é‚è¼¯ (Configuration Logic)

ç³»çµ±å•Ÿå‹•æ™‚è®€å– `config/` ä¸‹çš„æ‰€æœ‰ INI æª”ã€‚

### 3.1 `config/process.ini` (è£½ç¨‹ç«™é»)

```ini
[Process]
P1 = å°„å‡º
P2 = çƒ˜çƒ¤
P3 = ä¿®é‚Š
P4 = çµ„è£
P5 = åŒ…è£
```

### 3.2 `config/series.ini` (ç”¢å“ç³»åˆ—)

```ini
[Series]
AC = AirCase
MD = Mod NX é‚Šæ¡†
ST = SolidSuit
CA = CCA
```

### 3.3 `config/model.ini` (ç”¢å“æ©Ÿå‹)

```ini
[Model]
350 = iPhone 17
351 = iPhone 17 Air
352 = iPhone 17 Pro
001 = é€šç”¨å‹
```

### 3.4 `config/flow.ini` (è£½ç¨‹æµ - New!)

**ç”¨é€”**ï¼šå®šç¾©ç”¢å“çš„æ­£ç¢ºæµå‘ï¼Œç”¨æ–¼é·å…¥æ™‚çš„é˜²å‘†é©—è­‰ã€‚

```ini
[Flow]
# AirCase: ä¸éœ€è¦çƒ˜çƒ¤èˆ‡çµ„è£
AC = P1, P3, P5
# SolidSuit: å…¨è£½ç¨‹
ST = P1, P2, P3, P4, P5
# Mod NX: ä¸éœ€è¦çƒ˜çƒ¤
MD = P1, P3, P4, P5
# é è¨­
DEFAULT = P1, P2, P3, P4, P5
```

### 3.5 `config/container.ini` & `config/status.ini`

- **Container**: A1=100, OT=0...
- **Status**: G=è‰¯å“, N=ä¸è‰¯, S=ç‰¹æ¡, R=è¿”å·¥, E=éºå¤±

---

## 4. æ¢ç¢¼çµæ§‹å®šç¾© (Barcode Structure - 34 Chars)

**æ ¼å¼**ï¼š`[å·¥å–®8]-[è£½ç¨‹2]-[SKU5]-[å®¹å™¨2]-[ç®±è™Ÿ2]-[è²¨æ…‹1]-[æ•¸é‡4]-[æ ¡é©—3]`

**ç¯„ä¾‹**ï¼š`251119AA-P2-ST352-A1-01-G-0100-X4F`

---

## 5. æ¥­å‹™æµç¨‹èˆ‡ API (Business Workflow)

### 5.1 ğŸ” é–‹å·¥èˆ‡ç™»å…¥ (Setup)

- **å‰ç«¯**ï¼šæª¢æŸ¥ localStorageã€‚è‹¥ç„¡å·¥è™Ÿï¼Œé–å®šåœ¨è¨­å®šé ã€‚
- **è¨­å®šé **ï¼šè¼¸å…¥å·¥è™Ÿ (OP01)ã€é¸æ“‡ç•¶å‰ç«™é» (e.g., P2)ã€‚

### 5.2 ğŸ“¦ è²¨ç‰©é·å…¥ (Inbound) - å«é˜²å‘†é‚è¼¯

**API**: `POST /api/scan/inbound`

**Payload**: 
```json
{
  "barcode": "251119AA-P1-ST352-A1-01-G-0100-X4F",
  "operator_id": "OP01",
  "current_station_id": "P2"
}
```

**å¾Œç«¯é‚è¼¯**ï¼š
1. è§£ææ¢ç¢¼ï¼Œå–å¾— SKU (å‰2ç¢¼) èˆ‡ ä¸Šä¸€ç«™ ID (e.g., P1)ã€‚
2. **é˜²å‘†æª¢æŸ¥**ï¼š
   - è®€å– `flow.ini` æ‰¾åˆ°è©² SKU çš„æµç¨‹æ¸…å–®ã€‚
   - æª¢æŸ¥ `current_station_id` (P2) æ˜¯å¦ç‚º `previous_station_id` (P1) çš„åˆæ³•ä¸‹ä¸€ç«™ã€‚
   - è‹¥éŒ¯èª¤ï¼šå›å‚³ 400 Error ("éŒ¯èª¤ï¼P1 å¾ŒçºŒæ‡‰ç‚º P3ï¼Œä¸å¯è·³è‡³ P2")ã€‚
   - è‹¥æ­£ç¢ºï¼šå¯«å…¥ Google Sheet (Action='IN')ã€‚

**UI**ï¼šæˆåŠŸé¡¯ç¤ºç¶ è‰²å¡ç‰‡ï¼›æµç¨‹éŒ¯èª¤é¡¯ç¤ºç´…è‰²è­¦ç¤ºå½ˆçª—ã€‚

### 5.3 ğŸš€ è²¨ç‰©é·å‡º (Outbound)

**API**: `POST /api/scan/outbound`

**å‹•ä½œ**ï¼š
1. æƒææ¢ç¢¼ã€‚
2. ç¢ºèª/ä¿®æ”¹å®¹å™¨èˆ‡æ•¸é‡ã€‚
3. ç”Ÿæˆæ–°æ¢ç¢¼ï¼š
   - æ–°è£½ç¨‹ä»£è™Ÿ = ç•¶å‰ç«™é» (P2)ã€‚
   - è¨ˆç®—å·¥æ™‚ã€‚
   - å¯«å…¥ Sheet ä¸¦å›å‚³æ–°æ¢ç¢¼å­—ä¸²ã€‚

**å‰ç«¯æç¤º**ï¼šé·å‡ºæˆåŠŸæ™‚ï¼Œå¯æ ¹æ“š `flow.ini` æç¤ºä½¿ç”¨è€… "ä¸‹ä¸€ç«™å»ºè­°é€å¾€: P3"ã€‚

### 5.4 ğŸ” è¿½æº¯èˆ‡é¦–ç«™ (Trace & First)

- **é¦–ç«™é·å‡º**ï¼šæ‰‹å‹•è¼¸å…¥å·¥å–®è³‡è¨Šï¼Œç”Ÿæˆç¬¬ä¸€å€‹æ¢ç¢¼ã€‚
- **è¿½æº¯æŸ¥è©¢**ï¼šæƒæä»»ä¸€æ¢ç¢¼ï¼Œé¡¯ç¤ºè©²å·¥å–®çš„æ™‚é–“è»¸èˆ‡è‰¯ç‡çµ±è¨ˆã€‚

---

## 6. è³‡æ–™åº«è¨­è¨ˆ (Google Sheets)

å–®ä¸€å·¥ä½œè¡¨ **Logs**ï¼Œæ¬„ä½ï¼š

| æ¬„ä½åç¨± | èªªæ˜ |
|---------|------|
| timestamp | æ™‚é–“æˆ³è¨˜ |
| action | å‹•ä½œ (IN/OUT) |
| operator | æ“ä½œå“¡å·¥è™Ÿ |
| order | å·¥å–®è™Ÿ |
| process | è£½ç¨‹ç«™é» |
| sku | ç”¢å“ SKU |
| container | å®¹å™¨ä»£è™Ÿ |
| box_seq | ç®±è™Ÿ |
| qty | æ•¸é‡ |
| status | è²¨æ…‹ |
| cycle_time | å·¥æ™‚ |
| scanned_barcode | æƒæçš„æ¢ç¢¼ |
| new_barcode | æ–°ç”Ÿæˆçš„æ¢ç¢¼ |

---

## 7. å‰ç«¯ UI/UX è¦ç¯„ (iOS Style)

**Framework**: Tailwind CSS

**Style**ï¼š
- **Setup Page**: iOS Grouped List (è¼¸å…¥å·¥è™Ÿã€é¸æ“‡ç«™é»)
- **Dashboard**: iOS Widgets (Grid layout)
- **Scan Sheet**: Bottom Sheetï¼Œå¸¶æœ‰å‹•æ…‹é¡è‰²å›é¥‹
- **Flow Alert**: ç•¶é˜²å‘†è§¸ç™¼æ™‚ï¼Œå½ˆå‡º iOS Style Alert Dialog (éœ‡å‹•+ç´…è‰²)

---

## 8. å°ˆæ¡ˆç›®éŒ„çµæ§‹ (Project Structure)

```
fplts_project/
â”œâ”€â”€ config/                     # è¨­å®šæª”ç›®éŒ„
â”‚   â”œâ”€â”€ process.ini             # è£½ç¨‹ç«™é»å®šç¾©
â”‚   â”œâ”€â”€ series.ini              # ç”¢å“ç³»åˆ—å®šç¾©
â”‚   â”œâ”€â”€ model.ini               # ç”¢å“æ©Ÿå‹å®šç¾©
â”‚   â”œâ”€â”€ flow.ini                # è£½ç¨‹æµé˜²å‘†å®šç¾©
â”‚   â”œâ”€â”€ container.ini           # å®¹å™¨èˆ‡å®¹é‡å®šç¾©
â”‚   â””â”€â”€ status.ini              # è²¨æ…‹å®šç¾©
â”œâ”€â”€ services/                   # æ ¸å¿ƒé‚è¼¯å±¤
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ barcode.py              # æ¢ç¢¼è§£æã€ç”Ÿæˆã€CRCæ ¡é©—
â”‚   â”œâ”€â”€ sheet.py                # Google Sheets è®€å¯«æ“ä½œ
â”‚   â”œâ”€â”€ config_loader.py        # INI è®€å–å™¨
â”‚   â””â”€â”€ flow_validator.py       # é˜²å‘†é©—è­‰é‚è¼¯
â”œâ”€â”€ static/                     # å‰ç«¯è³‡æº
â”‚   â”œâ”€â”€ index.html              # SPA ä¸»é é¢
â”‚   â”œâ”€â”€ app.js                  # å‰ç«¯æ§åˆ¶é‚è¼¯
â”‚   â””â”€â”€ sounds/                 # éŸ³æ•ˆæª” (success.mp3, error.mp3)
â”œâ”€â”€ .env                        # ç’°å¢ƒè®Šæ•¸ (GOOGLE_SHEET_ID)
â”œâ”€â”€ credentials.json            # Google Service Account Key
â”œâ”€â”€ main.py                     # FastAPI æ‡‰ç”¨ç¨‹å¼å…¥å£
â””â”€â”€ requirements.txt            # Python ä¾è³´æ¸…å–®
```

---

## 9. é™„éŒ„

### 9.1 åƒè€ƒæ–‡ä»¶

- [å¾…è£œå……]

### 9.2 ç‰ˆæœ¬æ­·å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | èªªæ˜ |
|------|------|------|------|
| 1.0 | YYYY-MM-DD | [ä½œè€…] | åˆå§‹ç‰ˆæœ¬ |

---

**æ–‡ä»¶ç‹€æ…‹**ï¼šè‰ç¨¿  
**æœ€å¾Œæ›´æ–°**ï¼šYYYY-MM-DD  
**è² è²¬äºº**ï¼š[å¾…å¡«å¯«]
